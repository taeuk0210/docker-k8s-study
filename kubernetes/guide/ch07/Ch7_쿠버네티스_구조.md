# 📘 Chapter 7 쿠버네티스의 기본 구조

## 📌 학습 목표

- 쿠버네티스 기본 개념 학습

## 🔍 학습 내용

### 🔸 7.1 쿠버네티스의 개념

컨테이너화된 애플리케이션의 자동 배포, 확장 및 관리를 해주는 오픈소스 플랫폼

다수의 컨테이너를 쉽게 관리하기 위해 쿠버네티스를 사용합니다.(생성, 삭제 등)

### 🔸 7.2.1 쿠버네티스 클러스터

쿠버네티스는 다수의 노드로 구성되는 경우가 많다. 쿠버네티스 클러스터는 크게 마스터 노드, 워커 노드로 구분되는데  
개발자는 주로 마스터 노드와 통신, 사용자는 인터넷을 통해 워커 노드와 통신하는 경우가 많습니다.

위와 같은 구조를 유지하기 위해서는 마스터 노드와 워커 노드간의 유기적인 통신이 중요한데  
이를 위해 CNI(Container Network Interface)라는 개념이 사용됩니다.

CNI 사용을 위해 쿠버네티스 네트워크 플러그인을 제공(Flannel, calico 등)

### 🔸 7.2.2 컨트롤 플레인

쿠버네티스 마스터 노드는 컨트롤 플레인을 다루는데 이는 쿠버네티스 클러스터 전반의 작업을 관리하는 역할을 합니다.

컨트롤 플레인 구성요소

- **API 서버** : kubectl 명령어를 통해 마스터 노드의 kube-apiserver에게 API 요청을 보내면서 작업이 이루어짐  
   API 서버는 쿠버네티스 컨트롤 플레인의 프론트엔드 역할!

- **etcd** : 쿠버네티스 클러스터에 존재하는 모든 데이터를 저장하는 key-value 저장소

- **스케줄러** : 쿠버네티스에서 Pod라는 객체를 통해 애플리케이션을 실행하는데,  
   파드는 쿠버네티스 클러스터를 구성하는 노드 중 하나에 실행됨  
   이때 새롭게 생성되는 파드를 어느 노드에 실행시킬지 정하는 역할을 kube-scheduler가 수행

- **컨트롤러 매니저** : 쿠버네티스 리소스를 관리하고 제어하는 역할을 하며, 마스터 노드에서 실행됨
  deployment controller, service controller, replicaset controller 등의 여러 종류가 있음

### 🔸 7.2.3 노드

노드의 구성요소

- **Kubelet** : 각 노드에는 Kubelet이 실행되는데 이는 파드 내부의 컨테이너 실행을 담당함,  
  Kubelet이 파드의 상태를 모니터링, 문제가 생기면 해당 파드를 재배포

- **Kube-Proxy** : 노드에서 네트워크 역할을 수행함, 이것을 통해 노드에  
  존재하는 파드들이 쿠버네티스 내/외부에서 통신할 수 있음

- **컨테이너 런타임** : 컨테이너의 생명 주기를 담당, 이를 위해 kubelet은 컨테이너 런타임과  
  통신하고 이때 컨테이너 런타임 인터페이스를 사용함(containerd, CRI-O 등)

- **파드** : 쿠버네티스에서는 컨테이너가 파드 내에서 실행됨, 각 파드에는 하나 혹은 여러개의  
  컨테이너를 담을 수 있음, 다수의 파드들은 여러 워커 노드에 분산되어 실행되는데 하나의 파드에  
  속하는 컨테이너들은 모두 같은 노드에서 실행됨

### 🔸 7.2.4 워크로드

워크로드는 쿠버네티스에서 실행되는 애플리케이션을 의미함. 쿠버네티스는 파드 내부에서 워크로드를  
실행하는 것이고 이때 파드는 실행중인 컨테이너의 집합임

워크로드 종류

- **레플리카셋** : 파드의 복제를 관리하며 클라이언트가 요구하는 복제본 개수만큼  
  파드를 복제, 모니터링, 관리함

- **디플로이먼트** : 애플리케이션의 배포와 스케일링을 관리하는 역할

- **스테이트풀셋** : 파드 사이에서 순서와 고유성이 보장되어야 하는 경우에 사용

- **데몬셋** : 쿠버네티스를 구성하는 모든 노드가 파드의 복사본을 실행하도록 함  
  쿠버네티스 클러스터에 새로운 노드가 추가되면 파드 역시 추가됨  
  데몬셋은 주로 로깅, 모니터링, 스토리지 등의 시스템 수준 서비스 실행 시 사용

- **잡과 크론잡** : 작업이 정상적으로 완료되고 종료되는 것을 담당,  
  만약 파드가 정상적으로 종료되지 않는다면 재실행 시킴  
  잡은 작업이 한 번 종료되는 것을 담당하고  
  크론잡은 동일한 작업이 스케줄에 따라 여러번 수행하는것을 담당

### 🔸 7.2.5 네트워크

**서비스**  
쿠버네티스의 서비스를 사용하면 파드를 여러 개 묶어서 클러스터 외부로 노출시킬 수 있음, 이것의 장점은 이미 실행중인 파드를 외부로 노출시키기 위해 파드 내부를 수정할 필요가 없다는 것!

**인그래스**  
쿠버네티스 내부에 존재하는 서비스를 HTTP/HTTPS 루트를 클러스터 외부로 라우팅하는 역할을 함

### 🔸 7.2.6 스토리지

컨테이너에 문제가 생기거나 삭제되면 내부 파일이 삭제되기 때문에 내부에 존재하는 파일들은 수명이 짧음,  
쿠버네티스 스토리지를 활용하여 파드의 상태와 무관하게 파일을 보관할 수 있음
